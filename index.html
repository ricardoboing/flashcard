<html>
<head>
	<title>FlashCard</title>

	<style type="text/css">
		div.center {
			display: flex;
			justify-content: center;
			align-items: center;
			height: 100%;
		}
		button {
			float: left;
			padding: 15px 20px;
			font-weight: bold;
		}
		button.green {
			background-color: green;
			border: 3px darkgreen solid;
			color: white;
			margin-left: 2px;
		}
		button.blue {
			background-color: blue;
			border: 3px darkblue solid;
			color: white;
		}
		span#card {
			font-size: 1000%;
			color: rgb(200,0,0);
		}
		span#meaning {
			font-size: 500%;
		}
		span#meaning.hide {
			color: white;
		}
		span#meaning.visible {
			color: rgb(0,0,200);
		}
		span {
			font-weight: bold;
		}
		div.table {
			margin: 0 auto;
			display: flex;
			align-items: center;
			text-align: center;
			flex-direction: column;
		}
		div.main {
			margin: 0 auto;
			display: flex;
			flex: 0;
			height: 100%;
			justify-content: center;
			align-items: center;
		}
		div.meaning {
			background-color: white;
		}
		input {
			width: 600px;
			height: 70px;
			font-size: 50px;
			border-color: black;
			border-width: 3px;
			border-style: solid;
			color: black;
			text-align: center;
		}
		input.wrong {
			border: thick solid yellow;
			color: yellow;
			outline-color: rgb(215,215,0);
		}
		input.correct {
			border: thick solid blue;
			color: blue;
			outline: none;
		}
		input.not_answered {
			outline-color: rgb(20,20,20);
		}
		div#flashcard {
			display: none;
		}
	</style>
</head>
<body>
	<div class="main">
		<div class="table">
			<div id="menu">
				<button class="blue">Old deck</button>
				<button class="green">New deck</button>
			</div>
			<div id="flashcard">
				<div>
					<span id="card">START</span>
				</div>
				<div class="meaning">
					<span id="meaning">-----</span>
				</div>
				<div>
					<input id="answer" class="not_answered" type="text" autocomplete="off">
				</div>
			</div>
		</div>
	</div>
</body>
<!--
<script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
<script src="https://unpkg.com/react@17/umd/react.development.js" crossorigin></script>
<script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js" crossorigin></script>

<script type="text/babel">

</script>
-->
<script type="text/javascript">
	var deck = [
		["Again", "De novo/Novamente", 0],
		["Blue", "Azul", 0],
		["Black", "Preto", 0],
		["Yellow", "Amarelo", 0],
		["And", "e", 0],
		["Or", "ou", 0],
		["Row", "Linha/Fila", 0],
		["Cup", "XÃ­cara", 0],
		["Welcome", "Bem-vindo", 0],
		["Big", "Grande", 0],
		["Answer", "Resposta", 0],
		["Ask", "Pedir/Perguntar", 0],
	];

	shuffleArray(deck);

	console.log(deck);

	var card = document.getElementById("card");
	var meaning = document.getElementById("meaning");
	var answer = document.getElementById("answer");
	
	var pointer = 0;
	var limitInf = 0;
	var limitSup = deck.length;
	
	var showMeaning = false;
	var typeDeck = null;

	document.getElementById("menu").children[0].addEventListener("click", function() {
		show_flashcard();
		update_card();
		hide_meaning();
		typeDeck = "old";
	});
	document.getElementById("menu").children[1].addEventListener("click", function() {
		show_flashcard();
		update_card();
		hide_meaning();
		typeDeck = "new";
	});

	function show_flashcard() {
		document.getElementById("menu").style.display = "none";
		document.getElementById("flashcard").style.display = "block";
	}
	function get_answers() {
		var _answer = answer.value.toLowerCase();
		return _answer.split("/");
	}
	function get_meanings() {
		var _meaning = meaning.innerText.toLowerCase();
		return _meaning.split("/");
	}

	function is_answered() {
		if (answer.value == "") {
			return false;
		}
		return true;
	}

	function update_card() {
		if (pointer == limitSup) {
			card.innerText = "END";
			meaning.innerText = "---";
			return;
		}

		card.innerText = deck[pointer][0];
		meaning.innerText = deck[pointer][1];

		console.log(card.innerText);
	}
	function add_class(_element, _class) {
		_element.classList.add(_class);
	}
	function remove_class(_element, _class) {
		_element.classList.remove(_class);
	}
	
	function set_corret_answer() {
		add_class(answer, "correct");
		remove_class(answer, "wrong");
		remove_class(answer, "not_answered");
	}
	function set_wrong_answer() {
		remove_class(answer, "correct");
		add_class(answer, "wrong");
		remove_class(answer, "not_answered");
	}
	function clear_answer() {
		answer.value = "";

		remove_class(answer, "correct");
		remove_class(answer, "wrong");
		add_class(answer, "not_answered");
	}

	function show_meaning() {
		add_class(meaning, "visible");
		remove_class(meaning, "hide");
		showMeaning = true;
	}
	function hide_meaning() {
		add_class(meaning, "hide");
		remove_class(meaning, "visible");
		showMeaning = false;
		verifyAnswer = false;		
	}
	
	// Algoritmo was get in the web
	function shuffleArray(_array) {
		for (var i = _array.length - 1; i > 0; i--) {
			var j = Math.floor(Math.random() * (i + 1));
			var temp = _array[i];
			_array[i] = _array[j];
			_array[j] = temp;
		}
	}

	function verify_answer() {
		answers = get_answers();
		meanings = get_meanings();

		var correct = false;

		for (var i = 0; i < answers.length; i++) {
			correct = false;
			for (var j = 0; j < meanings.length; j++) {
				if (answers[i] == meanings[j]) {
					correct = true;
					break;
				}
			}
			
			if (!correct) {
				return false;
			}
		}

		if (!correct) {
			return false;
		}

		return true;
	}

	function previous_word() {
		pointer--;
		if (pointer < limitInf) {
			pointer = limitInf;
		}
		clear_answer();
		hide_meaning();
		update_card();
	}
	function next_word() {
		pointer++;
		if (pointer > limitSup) {
			pointer = limitSup;
			return;
		}
		clear_answer();
		hide_meaning();
		update_card();
	}

	function eventOldDeck(_key) {
		if (_key == "Enter" && !is_answered()) {
			return;
		}
		if (_key == "ArrowDown" || _key == "Enter") {
			if (pointer == limitSup) {
				return;
			}
			if (pointer == -1) { // Start
				next_word();
				return;
			}
			
			if (!showMeaning) {
				show_meaning();
				var correctAnswer = verify_answer();

				if (correctAnswer) {
					set_corret_answer();
					deck[pointer][2] = 1;
					return;
				}

				set_wrong_answer();
				deck[pointer][2] = 0;
				return;
			}
			console.log(deck[0], deck[1], deck[2], deck[3]);
			next_word();

			if (pointer == limitSup) {
				update_database();
			}
		}
		if (_key == "ArrowUp") {
			previous_word();
		}
	}

	var counterNewDeck = 1;
	function eventNewDeck(_key) {
		if (_key == "Enter" && !is_answered()) {
			return;
		}
		if (_key == "ArrowDown" || _key == "Enter") {
			if (!showMeaning) {
				show_meaning();
				var correctAnswer = verify_answer();

				if (correctAnswer) {
					set_corret_answer();
					deck[pointer][2] = 1;
					return;
				}

				set_wrong_answer();
				deck[pointer][2] = 0;
				return;
			}
			
			pointer++;
			// Turn back 4 positions
			if (pointer > counterNewDeck) {
				counterNewDeck = pointer;
				pointer = counterNewDeck - 4;
				
				if (pointer < limitInf) {
					pointer = limitInf;
				}
			}
			if (counterNewDeck > limitSup) {
				pointer = limitSup;
				return;
			}
			clear_answer();
			hide_meaning();
			update_card();
		}
	}
	function eventFunction(_event) {
		if (typeDeck == "old") {
			eventOldDeck(_event.key);
		} else {
			eventNewDeck(_event.key);
		}
	}

	window.addEventListener("keyup", eventFunction);
</script>
</html>